explain select es.tipo_beca, count(*) from (select * from estudiantes union select * from estudiantes2) e inner join (select * from estancias union select * from estancias2) es on e.codigo_estudiante=es.estudiante inner join (select * from universidades union select * from universidades2) u on u.codigo_erasmus=e.codigo_erasmus_universidades where u.pais='spain'  group by tipo_beca;
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| QUERY PLAN                                                                                                                                                                                                                                                                      |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| GroupAggregate  (cost=591.62..594.25 rows=150 width=40)                                                                                                                                                                                                                         |
|   Group Key: estancias.tipo_beca                                                                                                                                                                                                                                                |
|   ->  Sort  (cost=591.62..592.00 rows=150 width=32)                                                                                                                                                                                                                             |
|         Sort Key: estancias.tipo_beca                                                                                                                                                                                                                                           |
|         ->  Hash Join  (cost=537.30..586.20 rows=150 width=32)                                                                                                                                                                                                                  |
|               Hash Cond: (estancias.estudiante = estudiantes.codigo_estudiante)                                                                                                                                                                                                 |
|               ->  HashAggregate  (cost=220.04..238.99 rows=1895 width=60)                                                                                                                                                                                                       |
|                     Group Key: estancias.fecha_inicio, estancias.fecha_fin, estancias.tipo_beca, estancias.duracion, estancias.cuantia, estancias.estudiante, estancias.universidad                                                                                             |
|                     ->  Append  (cost=0.00..186.88 rows=1895 width=60)                                                                                                                                                                                                          |
|                           ->  Seq Scan on estancias  (cost=0.00..19.20 rows=920 width=60)                                                                                                                                                                                       |
|                           ->  Foreign Scan on estancias2  (cost=100.00..139.25 rows=975 width=60)                                                                                                                                                                               |
|               ->  Hash  (cost=317.07..317.07 rows=16 width=4)                                                                                                                                                                                                                   |
|                     ->  Hash Join  (cost=298.12..317.07 rows=16 width=4)                                                                                                                                                                                                        |
|                           Hash Cond: (estudiantes.codigo_erasmus_universidades = u.codigo_erasmus)                                                                                                                                                                              |
|                           ->  HashAggregate  (cost=165.59..173.50 rows=791 width=180)                                                                                                                                                                                           |
|                                 Group Key: estudiantes.codigo_estudiante, estudiantes.nombre, estudiantes.apellidos, estudiantes.direccion, estudiantes.pais, estudiantes.telefono, estudiantes.email, estudiantes.creditos_aprobados, estudiantes.codigo_erasmus_universidades |
|                                 ->  Append  (cost=0.00..147.80 rows=791 width=180)                                                                                                                                                                                              |
|                                       ->  Seq Scan on estudiantes  (cost=0.00..13.90 rows=390 width=180)                                                                                                                                                                        |
|                                       ->  Foreign Scan on estudiantes2  (cost=100.00..122.03 rows=401 width=180)                                                                                                                                                                |
|                           ->  Hash  (cost=132.48..132.48 rows=4 width=4)                                                                                                                                                                                                        |
|                                 ->  Subquery Scan on u  (cost=132.40..132.48 rows=4 width=4)                                                                                                                                                                                    |
|                                       ->  HashAggregate  (cost=132.40..132.44 rows=4 width=140)                                                                                                                                                                                 |
|                                             Group Key: universidades.codigo_erasmus, universidades.nombre, universidades.direccion, universidades.pais, universidades.telefono, universidades.email                                                                             |
|                                             ->  Append  (cost=0.00..132.34 rows=4 width=140)                                                                                                                                                                                    |
|                                                   ->  Seq Scan on universidades  (cost=0.00..16.00 rows=2 width=140)                                                                                                                                                            |
|                                                         Filter: (pais = 'spain'::text)                                                                                                                                                                                          |
|                                                   ->  Foreign Scan on universidades2  (cost=100.00..116.28 rows=2 width=140)                                                                                                                                                    |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
EXPLAIN
